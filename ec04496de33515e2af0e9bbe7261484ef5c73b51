{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "00a98fbe_ee030eaf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1262226
      },
      "writtenOn": "2020-12-18T16:56:47Z",
      "side": 1,
      "message": "Hi James, Scott,\nWe have updated the intrinsic optimization with correct precision as recently fixed in weight_mask_test.cc.\nOverall scaling has been reduced as intermediate precision is increased to 32-bit.\nPlease check the scaling numbers below,\n\n Block       mask_is_inverse\n Size        false      true\n 8x8         3.82x      4.17x\n 8x16\t     3.71x      3.99x\n 8x32\t     3.83x      4.14x\n 16x8\t     3.69x      4.09x\n 16x16\t     3.81x      4.23x\n 16x32\t     3.87x      4.30x\n 16x64\t     4.55x      4.99x\n 32x8\t     2.60x      2.58x\n 32x16\t     2.60x      2.57x\n 32x32\t     2.53x      2.54x\n 32x64\t     3.11x      3.07x\n 64x16\t     2.33x      2.37x\n 64x32\t     2.34x      2.38x\n 64x64\t     2.34x      2.41x\n 64x128\t     2.71x      2.78x\n 128x64\t     2.24x      2.28x\n 128x128     2.51x      2.47x\n \nPlease review the patch.\nThank you.",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "97004faf_357d2ec3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1002219
      },
      "writtenOn": "2020-12-19T04:06:58Z",
      "side": 1,
      "message": "this one looks good, just a couple of minor comments",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3008fb30_e3ec46b8",
        "filename": "src/dsp/x86/weight_mask_sse4.cc",
        "patchSetId": 7
      },
      "lineNbr": 458,
      "author": {
        "id": 1002219
      },
      "writtenOn": "2020-12-19T04:06:58Z",
      "side": 1,
      "message": "make these 3 local to the function they\u0027re used in; the constexpr\u0027s are ok, though they\u0027re only used in one place, but for vector types it\u0027s not clear what effect static const\u0027s will have across compilers.",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9345e073_440112ed",
        "filename": "src/dsp/x86/weight_mask_sse4.cc",
        "patchSetId": 7
      },
      "lineNbr": 458,
      "author": {
        "id": 1262226
      },
      "writtenOn": "2020-12-19T07:40:47Z",
      "side": 1,
      "message": "As you suggest 3 vectors are moved to WeightMask16_10bpp_SSE4()",
      "parentUuid": "3008fb30_e3ec46b8",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "310e30e7_bd3c02af",
        "filename": "src/dsp/x86/weight_mask_sse4.cc",
        "patchSetId": 7
      },
      "lineNbr": 465,
      "author": {
        "id": 1002219
      },
      "writtenOn": "2020-12-19T04:06:58Z",
      "side": 1,
      "message": "this comment is redundant given the loads on the next line",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0273f74e_5acd9915",
        "filename": "src/dsp/x86/weight_mask_sse4.cc",
        "patchSetId": 7
      },
      "lineNbr": 465,
      "author": {
        "id": 1262226
      },
      "writtenOn": "2020-12-19T07:40:47Z",
      "side": 1,
      "message": "Suggestion considered.",
      "parentUuid": "310e30e7_bd3c02af",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc6e0c66_b2186f4e",
        "filename": "src/dsp/x86/weight_mask_sse4.cc",
        "patchSetId": 7
      },
      "lineNbr": 470,
      "author": {
        "id": 1002219
      },
      "writtenOn": "2020-12-19T04:06:58Z",
      "side": 1,
      "message": "any difference with _mm_cvtepu8_epi16() instead?",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1f43234f_95db2682",
        "filename": "src/dsp/x86/weight_mask_sse4.cc",
        "patchSetId": 7
      },
      "lineNbr": 470,
      "author": {
        "id": 1262226
      },
      "writtenOn": "2020-12-19T07:40:47Z",
      "side": 1,
      "message": "_mm_unpacklo_epi16() instruction can be replaced with _mm_cvtepu16_epi32(). But _mm_unpackhi_epi16() is also used in our logic below. _mm_unpackhi_epi16() may not be replaced with single _mm_cvtepu16_epi32() instruction.\n\nSo for consistency, we preferred to use _mm_unpacklo_epi16() than _mm_cvtepu16_epi32() here.",
      "parentUuid": "bc6e0c66_b2186f4e",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a4857df7_633c47fc",
        "filename": "src/dsp/x86/weight_mask_sse4.cc",
        "patchSetId": 7
      },
      "lineNbr": 470,
      "author": {
        "id": 1002219
      },
      "writtenOn": "2020-12-19T23:15:52Z",
      "side": 1,
      "message": "\u003e _mm_unpacklo_epi16() instruction can be replaced with _mm_cvtepu16_epi32(). But _mm_unpackhi_epi16() is also used in our logic below. _mm_unpackhi_epi16() may not be replaced with single _mm_cvtepu16_epi32() instruction.\n\u003e \n\u003e So for consistency, we preferred to use _mm_unpacklo_epi16() than _mm_cvtepu16_epi32() here.\n\nConsistency is important, but we\u0027re also concerned with speed and instruction count. _mm_cvtepu16_epi32 will result in fewer instructions, timing being equal I\u0027d use it.\n\nfrom gcc 10.2.0:\n_mm_unpacklo_epi16\n     db08:   66 0f ef db             pxor   xmm3,xmm3           \n     db0c:   66 0f 6f 6e 10          movdqa xmm5,XMMWORD PTR [rs\n     db11:   66 0f 6f c8             movdqa xmm1,xmm0           \n     db15:   66 0f 6f d4             movdqa xmm2,xmm4           \n     db19:   66 0f 69 c3             punpckhwd xmm0,xmm3        \n     db1d:   66 0f 61 d3             punpcklwd xmm2,xmm3        \n     db21:   66 0f 69 e3             punpckhwd xmm4,xmm3        \n     db25:   66 0f 61 cb             punpcklwd xmm1,xmm3 \n\n_mm_cvtepu16_epi32\n     db08:   66 0f ef db             pxor   xmm3,xmm3\n     db0c:   66 0f 6f 6e 10          movdqa xmm5,XMMWORD PTR [rs\n     db11:   66 0f 38 33 d4          pmovzxwd xmm2,xmm4         \n     db16:   66 0f 38 33 c8          pmovzxwd xmm1,xmm0         \n     db1b:   66 0f 69 e3             punpckhwd xmm4,xmm3        \n     db1f:   66 0f 69 c3             punpckhwd xmm0,xmm3        \n\noverall the size of the object goes from 125080 to 122440.",
      "parentUuid": "1f43234f_95db2682",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a6647f0b_196c7c14",
        "filename": "src/dsp/x86/weight_mask_sse4.cc",
        "patchSetId": 7
      },
      "lineNbr": 470,
      "author": {
        "id": 1262226
      },
      "writtenOn": "2020-12-20T11:11:09Z",
      "side": 1,
      "message": "Thanks for your explanation with details.\nWe have replaced _mm_unpacklo_epi16() instruction with _mm_cvtepu16_epi32().",
      "parentUuid": "a4857df7_633c47fc",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93495045_9c22a52a",
        "filename": "src/dsp/x86/weight_mask_sse4.cc",
        "patchSetId": 7
      },
      "lineNbr": 482,
      "author": {
        "id": 1002219
      },
      "writtenOn": "2020-12-19T04:06:58Z",
      "side": 1,
      "message": "the same here",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "266915c4_a194c399",
        "filename": "src/dsp/x86/weight_mask_sse4.cc",
        "patchSetId": 7
      },
      "lineNbr": 482,
      "author": {
        "id": 1262226
      },
      "writtenOn": "2020-12-19T07:40:47Z",
      "side": 1,
      "message": "Suggestion considered.",
      "parentUuid": "93495045_9c22a52a",
      "revId": "ec04496de33515e2af0e9bbe7261484ef5c73b51",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}